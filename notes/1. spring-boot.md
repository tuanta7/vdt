# Spring Boot

[Spring Projects](https://spring.io/projects): Additional Spring modules built-on-top of the core Spring Framework. E.g: **Spring Boot**, Spring LDAP, Spring Security, etc.

Spring Framework is a popular open-source framework for building Java applications. It provides a comprehensive set of tools and libraries that handle common development tasks, allowing programmers to focus on the core functionality of their applications.

`Spring Boot` is an open-source project that simplifies the creation of applications with the Spring Framework.

- Spring Boot eliminates the need for a lot of complex configuration that's typically required for Spring applications.
  - Provide an embedded HTTP server (Tomcat, Jetty, Undertow,...)
- Spring Boot applications can run on their own without needing to be deployed to a separate web server
- Spring Boot can automatically configure a lot of things out of the box based on the libraries you include in your project.

We can quickly create a starter Spring Boot project using [Spring Initializr](https://start.spring.io/)

- Artifact: project coordinates (id of the artifact, as referred by the `artifactId` attribute in Apache Maven). Also infers the name of the project
- Name: display name of the project that also determines the name of your Spring Boot application.
- [All Options](https://docs.spring.io/initializr/docs/0.4.x/reference/htmlsingle/#getting-started-advanced-options)

## 1. Running/Deploy Spring Boot App

- Spring Boot apps are self-contained, they can be run standalone (includes its embedded server)

```bash
# Package executable jar/war archive
mvnw package

# Option 1: Use Java
java -jar myserver.jar
# Option 2: Use Maven Wrapper or Spring Boot Maven plugin
mvnw spring-boot run
```

- Spring Boot apps can also be deployed in the traditional way using the `WAR file` (Web Application Archive - `.war`) on an external server: Tomcat, JBoss, WebSphere, etc. One HTTP server can serve many WAR files/apps

## 2. Maven

> When building Java project, we may need additional JAR files (Hibernate, JSON, Commons Logging, etc.). One approach is to download the JAR files from each project web site and manually add the JAR files to our build path (classpath). A better approach is to use tools like Maven or Gradle to manage our dependencies instead.

`Maven` is an open-source **build automation tool** originally designed for Java projects (it can also be used for projects written in other languages like C#, Ruby, and Scala). Maven functions as a project management tool, simplifying the build process for software development.

- A crucial aspect of Maven is **dependency management**. It handles the retrieval and management of external libraries your project relies on. This ensures all necessary components are included and avoids version conflicts.
- It automates repetitive tasks involved in building software, such as compiling source code, packaging compiled classes into executable files, running tests, and generating documentation. This streamlines development and reduces errors.
- Maven stores dependencies at `~/. m2` or `C:\Users\<username>\.m2`

### Maven Key Concepts

Maven uses a concept called a **Project Object Model** (POM) to define and manage a project's configuration, dependencies, and lifecycle (using `pom.xml` file).

- Coordiantes: Maven coordinates identify uniquely a project, a dependency, or a plugin defined in POM
- Dependency Coordinates: A valid Maven POM file must have `groupId` & `artifactId`

```xml
<!-- GAV -->
<groupId>com.example</groupId>
<artifactId>demo</artifactId>
<version>1.0.0</version>
```

- Using Maven in terminal

```sh
# Clean the project and install the build artifacts using Maven
mvn clean install
# Package executable jar/war archive
mvn package
# Run Spring Boot app
mvn spring-boot:run
```

## 3. Project Structure (Spring Boot + Maven)

| Directory          | Description                                                                       |
| ------------------ | --------------------------------------------------------------------------------- |
| src/main/java      | Java source code                                                                  |
| src/main/resources | Properties / Config files used by ourr app                                        |
| src/main/webapp    | JSP files, Web config files, web assets (images, css, js, etc.) for MVC app (SSR) |
| src/test           | Unit testing code                                                                 |
| target             | Destination directory for compiled code (created by Maven)                        |

- `src/main/webapp` only works with WAR packaging (not JAR)

### Packages Structures

| Package                  | Description                                                                           |
| ------------------------ | ------------------------------------------------------------------------------------- |
| controller               | contains classes that handle incoming web requests and return responses to the client |
| entity                   | contains classes that represent the database entities                                 |
| service                  | contains business logic (use DAO to interact with database)                           |
| dao (Data Access Object) | contains interfaces and classes responsible for data persistence                      |

### Special files/folders

| Directory                                | Description                                                                                                                       |
| ---------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- |
| src/main/resource/application.properties | (Created by Spring Initializr) Store application constants and configurations                                                     |
| src/main/templates                       | SpringBoot includes auto-configuration for following template engines: **ThymeLeaf**, FreeMarker & Mustache                       |
| mvnw                                     | Script for Maven Wrapper, which allows you to run Maven without having it installed on your machine                               |
| mvnw.cmd (or mvnw.sh)                    | Batch script for Windows systems that is part of the Maven Wrapper (It serves the same purpose as the mvnw shell script for Unix) |

E.g: clean the project and install the build artifacts, using the specific Maven version defined by the wrapper.

```sh
mvnw.cmd clean install
./mvnw clean install
```

## 4. Spring Boot Starters

Spring Boot Starters are a set of dependency descriptors provided by Spring Boot that make it easier to include a collection of commonly used dependencies in a Spring-based application.

- They simplify the configuration process by aggregating multiple libraries and configurations into a single dependency, which can be added to a project's build configuration
- Examples of Spring Boot Starters:
  - `spring-boot-starter`: Core starter, including auto-configuration support, logging, and YAML configuration.
  - `spring-boot-starter-web`: Starter for building web applications, including RESTful services using Spring MVC, and Tomcat as the default embedded container.
  - `spring-boot-starter-data-jpa`: Starter for using Spring Data JPA with Hibernate.
  - `spring-boot-starter-security`: Starter for using Spring Security.

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
```

### Parent

The parent project manages the configuration and dependencies common to all Spring Boot starters.

- It's essentially the parent project that other Spring Boot starters inherit from.
- The Starters Parent project helps to centralize and manage common configurations, plugin versions, and dependency management for all Spring Boot starters.

```xml
<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>3.2.5</version>
		<relativePath/> <!-- lookup parent from repository -->
	</parent>
```

## 5. Spring Boot Actuators

Spring Boot Actuator is a sub-project of Spring Boot that provides a set of tools for monitoring and managing Spring Boot applications

- It includes several built-in endpoints (`/actuator/*`) that expose various metrics, health checks, and other application-related information, which can be accessed via HTTP, JMX, or other protocols.
- Key Features of Spring Boot Actuator:
  - Health Checks: `/health`
  - Metrics: `/metrics`
  - Application Information: `/info`
  - Auditing, Tracing, and Logging: `/httptrace`, `/loggers`
  - etc.
- See all endpoints [here](https://docs.spring.io/spring-boot/docs/2.1.13.RELEASE/reference/html/production-ready-endpoints.html)

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

- By default, only `/actuator/health` is exposed
- We can expose an endpoint by adding new properties to `application.properties` file

```txt
management.endpoints.web.exposure.include=health,info
management.info.env.enabled=true

info.app.name=Spring Boot App
info.app.description=My First Spring Boot App
info.app.version=0.0.1
```

- Use wildcard `*` to expose all actuator endpoints over HTTP

```py
management.endpoints.web.exposure.include=*
management.endpoints.web.exposure.exclude=threaddump  # Exclude /threaddump endpoint
```

### Using `Spring Security` to secure endpoints

- Add `spring-boot-starter-security` to project,
- Default username is: `user`

```xml
<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

- Edit login properties (Optional)

```
spring.security.user.name=admin
spring.security.user.password=admin
```

## 6. Spring Boot DevTools (auto-restart)

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
</dependency>
```

## 7. Custom properties in `application.properties` & Configuring Server

Spring Boot allow us to define properties in a configuration file then use the `@Value` annotation or `@ConfigurationProperties` to inject these properties into our beans.

```py
# Custom properties
coach.name=Ancelotti
team.name=Real Madrid
```

```java
@Value("${team.name}")
private String team;

@GetMapping("/team")
public String getTeam() {
    return "Team: " + team;
}
```

Define properties in the `application.properties` file also allows you to customize various aspects of the embedded server, such as the port, context path, and other server settings. Here are some common configurations. Here are ssome common configurations:

```py
# Configuring Spring Boot Server
server.port=8081
server.servlet.context-path=/api
server.address=127.0.0.1
server.servlet.session.timeout=1200

# SSL
server.ssl.enabled=true
server.ssl.key-store=classpath:keystore.jks
server.ssl.key-store-password=changeit
server.ssl.key-password=changeit

# HTTP2
server.http2.enabled=true
```

#### Run Spring Boot apps from Command Line

```bash
# Check
java --version
echo %JAVA_HOME%

# Build
./mvnw package

# Run
java -jar .\target\demo-0.0.1-SNAPSHOT.jar
./mvnw spring-boot:run
```
